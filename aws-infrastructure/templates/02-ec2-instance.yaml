# ===================================================================
# CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆWebã‚µãƒ¼ãƒãƒ¼ï¼‰
#
# ç›®çš„: FuelPHP + React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®Webã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰
# æ§‹æˆ: EC2 t3.micro + Nginx + PHP-FPM + Node.js
# è²»ç”¨: å®Œå…¨ç„¡æ–™ï¼ˆAWSç„¡æ–™ãƒ†ã‚£ã‚¢ç¯„å›²å†…ï¼‰
# ä¾å­˜: 01-vpc-network.yaml ã®VPCã‚¹ã‚¿ãƒƒã‚¯ãŒå¿…è¦
# ===================================================================

AWSTemplateFormatVersion: '2010-09-09'
Description: 'EC2 Web Server for Portfolio (Free Tier)'

# ===================================================================
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼: ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«å¤‰æ›´å¯èƒ½ãªå€¤
# ===================================================================
Parameters:
  ProjectName:
    Type: String
    Default: 'portfolio'
    Description: 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼ˆãƒªã‚½ãƒ¼ã‚¹åã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰'

  Environment:
    Type: String
    Default: 'prod'
    AllowedValues: ['dev', 'staging', 'prod']
    Description: 'ç’°å¢ƒåï¼ˆé–‹ç™ºãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ»æœ¬ç•ªï¼‰'

  NetworkStackName:
    Type: String
    Default: 'portfolio-network'
    Description: 'VPCã‚¹ã‚¿ãƒƒã‚¯åï¼ˆ01-vpc-network.yamlã§ä½œæˆã—ãŸã‚¹ã‚¿ãƒƒã‚¯åï¼‰'
    # ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã§ä»–ã®ã‚¹ã‚¿ãƒƒã‚¯ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‚ç…§

  KeyPairName:
    Type: String
    Description: 'SSHæ¥ç¶šç”¨ã®EC2ã‚­ãƒ¼ãƒšã‚¢åï¼ˆäº‹å‰ã«AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä½œæˆãŒå¿…è¦ï¼‰'
    # ä¾‹: my-keypair
    # æ³¨æ„: CloudFormationã§ã¯ã‚­ãƒ¼ãƒšã‚¢ã®ä½œæˆã¯ã§ããªã„ãŸã‚äº‹å‰ä½œæˆå¿…é ˆ

  InstanceType:
    Type: String
    Default: 't3.micro'
    AllowedValues: ['t2.micro', 't3.micro', 't3.small']
    Description: 'EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ï¼ˆç„¡æ–™æ : t2.micro ã¾ãŸã¯ t3.microï¼‰'

# ===================================================================
# ãƒãƒƒãƒ”ãƒ³ã‚°: åœ°åŸŸåˆ¥ã®è¨­å®šå€¤
# ===================================================================
Mappings:
  # åœ°åŸŸåˆ¥AMI ID ãƒãƒƒãƒ”ãƒ³ã‚°
  # Amazon Linux 2ã®æœ€æ–°AMIï¼ˆåœ°åŸŸã«ã‚ˆã£ã¦ç•°ãªã‚‹ï¼‰
  RegionMap:
    us-east-1:      # ãƒãƒ¼ã‚¸ãƒ‹ã‚¢åŒ—éƒ¨
      AMI: ami-0abcdef1234567890  # ä¾‹: Amazon Linux 2 AMI
    us-west-2:      # ã‚ªãƒ¬ã‚´ãƒ³
      AMI: ami-0fedcba0987654321  # ä¾‹: Amazon Linux 2 AMI
    ap-northeast-1: # æ±äº¬
      AMI: ami-0123456789abcdef0  # ä¾‹: Amazon Linux 2 AMI
    eu-west-1:      # ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰
      AMI: ami-0987654321fedcba0  # ä¾‹: Amazon Linux 2 AMI
  # æ³¨æ„: å®Ÿéš›ã®AMI IDã¯å®šæœŸæ›´æ–°ã•ã‚Œã‚‹ãŸã‚ã€æœ€æ–°IDã‚’ç¢ºèªã—ã¦ãã ã•ã„

# ===================================================================
# ãƒªã‚½ãƒ¼ã‚¹: å®Ÿéš›ã«ä½œæˆã™ã‚‹AWSã‚µãƒ¼ãƒ“ã‚¹ç¾¤
# ===================================================================
Resources:

  # -------------------------------------------------------------------
  # 1. EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆãƒ¡ã‚¤ãƒ³ã®Webã‚µãƒ¼ãƒãƒ¼ï¼‰
  #
  # å½¹å‰²: FuelPHP + React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‹•ä½œã•ã›ã‚‹Webã‚µãƒ¼ãƒãƒ¼
  # ä¾‹ãˆ: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‹•ä½œã™ã‚‹ã€Œã‚µãƒ¼ãƒãƒ¼ãƒã‚·ãƒ³ã€
  # é‡è¦: UserDataã§èµ·å‹•æ™‚ã«å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  # -------------------------------------------------------------------
  WebServer:
    Type: AWS::EC2::Instance
    Properties:
      # ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—: ç„¡æ–™æ å¯¾è±¡ã®æœ€å°ã‚µã‚¤ã‚º
      # t3.micro = 1vCPU, 1GB RAMï¼ˆååˆ†ãªæ€§èƒ½ï¼‰
      InstanceType: !Ref InstanceType

      # AMIï¼ˆAmazon Machine Imageï¼‰: OSã¨ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
      # Amazon Linux 2ã‚’ä½¿ç”¨ï¼ˆç„¡æ–™ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°ã‚ã‚Šã€AWSæœ€é©åŒ–æ¸ˆã¿ï¼‰
      ImageId: !FindInMap [RegionMap, !Ref 'AWS::Region', AMI]

      # SSHæ¥ç¶šç”¨ã‚­ãƒ¼ãƒšã‚¢
      # äº‹å‰ã«AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä½œæˆã—ãŸã‚­ãƒ¼ãƒšã‚¢åã‚’æŒ‡å®š
      # ã“ã‚ŒãŒãªã„ã¨EC2ã«SSHæ¥ç¶šã§ããªã„
      KeyName: !Ref KeyPairName

      # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š: ä»–ã®ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰å€¤ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
      # VPCã‚¹ã‚¿ãƒƒã‚¯ã§ä½œæˆã—ãŸãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã«é…ç½®
      SubnetId: !ImportValue
        Fn::Sub: '${NetworkStackName}-PublicSubnetId'

      # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—: ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š
      # VPCã‚¹ã‚¿ãƒƒã‚¯ã§ä½œæˆã—ãŸEC2ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é©ç”¨
      SecurityGroupIds:
        - !ImportValue
          Fn::Sub: '${NetworkStackName}-EC2SecurityGroupId'

      # EBSï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰è¨­å®š
      # ç„¡æ–™æ : 30GB ã¾ã§ã®gp2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
      BlockDeviceMappings:
        - DeviceName: /dev/xvda  # ãƒ«ãƒ¼ãƒˆãƒ‡ãƒã‚¤ã‚¹
          Ebs:
            VolumeType: gp2      # æ±ç”¨SSDï¼ˆç„¡æ–™æ å¯¾è±¡ï¼‰
            VolumeSize: 30       # 30GBï¼ˆç„¡æ–™æ ä¸Šé™ï¼‰
            DeleteOnTermination: true  # ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å‰Šé™¤æ™‚ã«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚‚å‰Šé™¤

      # UserData: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
      # é‡è¦: ã“ã“ã§Webã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒã‚’è‡ªå‹•æ§‹ç¯‰
      UserData:
        Fn::Base64: !Sub |
          #!/bin/bash
          # ===================================================================
          # EC2èµ·å‹•æ™‚è‡ªå‹•å®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
          # ç›®çš„: LEMPç’°å¢ƒï¼ˆLinux + Nginx + MySQL + PHPï¼‰ã®æ§‹ç¯‰
          # ===================================================================

          # ãƒ­ã‚°è¨­å®š: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œãƒ­ã‚°ã‚’è¨˜éŒ²
          exec > >(tee /var/log/user-data.log|logger -t user-data -s 2>/dev/console) 2>&1
          echo "=== UserData script started at $(date) ==="

          # ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒé©ç”¨ï¼‰
          echo "=== Updating system packages ==="
          yum update -y

          # å¿…è¦ãªãƒªãƒã‚¸ãƒˆãƒªè¿½åŠ 
          echo "=== Adding repositories ==="
          # EPELï¼ˆExtra Packages for Enterprise Linuxï¼‰: è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
          amazon-linux-extras install epel -y
          # PHP 8.0: æœ€æ–°ã®PHPç‰ˆ
          amazon-linux-extras install php8.0 -y

          # Webã‚µãƒ¼ãƒãƒ¼é–¢é€£ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          echo "=== Installing web server packages ==="
          yum install -y \
            nginx \                    # Webã‚µãƒ¼ãƒãƒ¼
            php \                      # PHPæœ¬ä½“
            php-fpm \                  # PHP FastCGI Process Manager
            php-mysqlnd \              # MySQLç”¨PHPãƒ‰ãƒ©ã‚¤ãƒãƒ¼
            php-json \                 # JSONå‡¦ç†
            php-xml \                  # XMLå‡¦ç†
            php-mbstring \             # ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—åˆ—å‡¦ç†
            php-gd \                   # ç”»åƒå‡¦ç†
            php-curl \                 # HTTPé€šä¿¡
            mysql \                    # MySQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
            git \                      # ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
            unzip                      # ãƒ•ã‚¡ã‚¤ãƒ«è§£å‡

          # Node.js ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆReactç”¨ï¼‰
          echo "=== Installing Node.js ==="
          # NVMï¼ˆNode Version Managerï¼‰ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
          # NVMã‚’ç¾åœ¨ã®ã‚·ã‚§ãƒ«ã§æœ‰åŠ¹åŒ–
          export NVM_DIR="$HOME/.nvm"
          [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
          # Node.js LTSç‰ˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          nvm install --lts
          nvm use --lts
          # npmï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼‰ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
          npm install -g npm@latest

          # PHPè¨­å®šã®æœ€é©åŒ–
          echo "=== Configuring PHP ==="
          # PHPã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†
          sed -i 's/;date.timezone =/date.timezone = Asia\/Tokyo/' /etc/php.ini
          sed -i 's/upload_max_filesize = 2M/upload_max_filesize = 10M/' /etc/php.ini
          sed -i 's/post_max_size = 8M/post_max_size = 10M/' /etc/php.ini
          # PHP-FPMã®è¨­å®šï¼ˆNginxã¨ã®é€£æºç”¨ï¼‰
          sed -i 's/user = apache/user = nginx/' /etc/php-fpm.d/www.conf
          sed -i 's/group = apache/group = nginx/' /etc/php-fpm.d/www.conf

          # Nginxè¨­å®š
          echo "=== Configuring Nginx ==="
          # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
          cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup

          # Nginxè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
          cat > /etc/nginx/conf.d/portfolio.conf << 'EOL'
          server {
              listen 80;
              server_name _;  # ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã§å—ã‘ä»˜ã‘
              root /var/www/html;
              index index.php index.html;

              # PHPå‡¦ç†ã®è¨­å®š
              location ~ \.php$ {
                  fastcgi_pass unix:/run/php-fpm/www.sock;
                  fastcgi_index index.php;
                  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                  include fastcgi_params;
              }

              # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ï¼ˆReactç”¨ï¼‰
              location / {
                  try_files $uri $uri/ /index.php?$query_string;
              }

              # ãƒ­ã‚°è¨­å®š
              access_log /var/log/nginx/portfolio_access.log;
              error_log /var/log/nginx/portfolio_error.log;
          }
          EOL

          # Webãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆã¨æ¨©é™è¨­å®š
          echo "=== Setting up web directory ==="
          mkdir -p /var/www/html
          chown -R nginx:nginx /var/www/html
          chmod -R 755 /var/www/html

          # ãƒ†ã‚¹ãƒˆç”¨ã®PHPãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
          cat > /var/www/html/info.php << 'EOL'
          <?php
          // PHPå‹•ä½œç¢ºèªç”¨ãƒ•ã‚¡ã‚¤ãƒ«
          phpinfo();
          ?>
          EOL

          # ç°¡å˜ãªãƒ†ã‚¹ãƒˆç”¨HTMLãƒ•ã‚¡ã‚¤ãƒ«
          cat > /var/www/html/index.html << 'EOL'
          <!DOCTYPE html>
          <html>
          <head>
              <title>Portfolio Server - Ready!</title>
              <style>
                  body { font-family: Arial, sans-serif; text-align: center; margin-top: 100px; }
                  .container { max-width: 600px; margin: 0 auto; }
                  .status { color: green; font-size: 24px; font-weight: bold; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>ğŸš€ Portfolio Server</h1>
                  <p class="status">âœ… Server is Running!</p>
                  <p>FuelPHP + React development environment is ready.</p>
                  <p><a href="/info.php">PHP Info</a></p>
              </div>
          </body>
          </html>
          EOL

          # ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•è¨­å®š
          echo "=== Starting services ==="
          # ã‚µãƒ¼ãƒ“ã‚¹ã®è‡ªå‹•èµ·å‹•è¨­å®š
          systemctl enable nginx
          systemctl enable php-fpm

          # ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹
          systemctl start php-fpm
          systemctl start nginx

          # ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šï¼ˆAmazon Linux 2ã®iptablesï¼‰
          echo "=== Configuring firewall ==="
          # HTTPï¼ˆ80ç•ªãƒãƒ¼ãƒˆï¼‰ã‚’è¨±å¯
          iptables -I INPUT -p tcp --dport 80 -j ACCEPT
          # è¨­å®šã‚’æ°¸ç¶šåŒ–
          service iptables save

          # æœ€çµ‚ç¢ºèª
          echo "=== Final checks ==="
          echo "Nginx status:"
          systemctl status nginx --no-pager
          echo "PHP-FPM status:"
          systemctl status php-fpm --no-pager
          echo "Disk usage:"
          df -h

          echo "=== UserData script completed successfully at $(date) ==="

      # ã‚¿ã‚°è¨­å®š: ãƒªã‚½ãƒ¼ã‚¹ã®è­˜åˆ¥ã¨ç®¡ç†ç”¨
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${Environment}-web-server'
        - Key: Environment
          Value: !Ref Environment
        - Key: Project
          Value: !Ref ProjectName
        - Key: Purpose
          Value: 'Web Server for Portfolio Application'

  # -------------------------------------------------------------------
  # 2. Elastic IPï¼ˆå›ºå®šIPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰- ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  #
  # å½¹å‰²: EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å›ºå®šã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦
  # ãƒ¡ãƒªãƒƒãƒˆ: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†èµ·å‹•ã—ã¦ã‚‚IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰ã‚ã‚‰ãªã„
  # æ³¨æ„: ç„¡æ–™æ ã§ã¯1å€‹ã¾ã§ç„¡æ–™ã€ä½¿ã‚ãªã„å ´åˆã¯èª²é‡‘å¯¾è±¡
  # -------------------------------------------------------------------
  ElasticIP:
    Type: AWS::EC2::EIP
    Properties:
      # EC2-VPCãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆVPCå†…ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”¨ï¼‰
      Domain: vpc
      # ä½œæˆã—ãŸEC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«é–¢é€£ä»˜ã‘
      InstanceId: !Ref WebServer
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-${Environment}-eip'

# ===================================================================
# ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ: ä»–ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚„å¤–éƒ¨ã‹ã‚‰å‚ç…§ã™ã‚‹å€¤
# ===================================================================
Outputs:
  # EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID
  InstanceId:
    Description: 'EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ID'
    Value: !Ref WebServer
    Export:
      Name: !Sub '${AWS::StackName}-InstanceId'

  # ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆElastic IPï¼‰
  PublicIP:
    Description: 'ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆWebã‚µã‚¤ãƒˆã‚¢ã‚¯ã‚»ã‚¹ç”¨ï¼‰'
    Value: !Ref ElasticIP
    Export:
      Name: !Sub '${AWS::StackName}-PublicIP'

  # Webã‚µã‚¤ãƒˆURL
  WebsiteURL:
    Description: 'Webã‚µã‚¤ãƒˆURLï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰'
    Value: !Sub 'http://${ElasticIP}'
    Export:
      Name: !Sub '${AWS::StackName}-WebsiteURL'

  # SSHæ¥ç¶šã‚³ãƒãƒ³ãƒ‰ä¾‹
  SSHCommand:
    Description: 'SSHæ¥ç¶šã‚³ãƒãƒ³ãƒ‰ä¾‹'
    Value: !Sub 'ssh -i ${KeyPairName}.pem ec2-user@${ElasticIP}'

# ===================================================================
# æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸå¾Œ
#
# 1. RDSãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
# 2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤
# 3. ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šã¨SSLè¨¼æ˜æ›¸ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
#
# ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ä¾‹:
# aws cloudformation create-stack \
#   --stack-name your-project-ec2 \
#   --template-body file://02-ec2-instance.yaml \
#   --parameters ParameterKey=NetworkStackName,ParameterValue=your-project-network \
#                ParameterKey=KeyPairName,ParameterValue=your-keypair
# ===================================================================